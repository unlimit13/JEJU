package db;


import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.nio.charset.Charset;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Scanner;


public class JEJU {
	
	private static String url = "jdbc:postgresql://localhost:5432/postgres";
	private static String user = "postgres";
	private static String password = "inter7477";
	

	public static void main(String args[]) throws SQLException, IOException {
		Connection conn = null;
		
		Scanner scan = new Scanner(System.in);
		int result;
		String sql;
		PreparedStatement ps;
	    ResultSet rs;
		
		
		try {
			Class.forName("org.postgresql.Driver");
			conn = DriverManager.getConnection(JEJU.url, JEJU.user, JEJU.password );
			sql = "create table if not exists host(uID varchar(20), pwd varchar(20), sex char(2), age int, direction char(2));";
			ps = conn.prepareStatement(sql);
			result = ps.executeUpdate();
			Statement statement = conn.createStatement();
			//total_attraction(statement); //(total attraction ���̺� ������ attraction ��� ��ħ)
			
			while(true) 
			{	
				System.out.println("-----------------");
				System.out.println("1. sign up");
				System.out.println("2. sign in");
				System.out.println("3. Exit");
				System.out.println("4. admin");
				System.out.println("-----------------");
				String Direction = "";
				String bit = scan.nextLine(); 

				
				if(bit.contains("1")) { 	//bit1�� sign up
					System.out.println();
					System.out.println("-----------------");
					System.out.print("ID : ");
					
					String uID = scan.nextLine();
					
					System.out.print("PW : ");
					String PWD = scan.nextLine();
					
					System.out.print("Sex(F,M) : ");
					String Sex = scan.nextLine();
					
					System.out.print("Age : ");
					String temp = scan.nextLine();
					int Age = Integer.parseInt(temp);
					
					System.out.print("plan to visit[E,W,S,N] : ");
					Direction = scan.nextLine();
					
					System.out.println("-----------------");
					
					sql = "insert into host values(?,?,?,?,?);";
			        ps = conn.prepareStatement(sql);
			        ps.clearParameters();
			        ps.setString(1,uID);
			        ps.setString(2,PWD);
			        ps.setString(3,Sex);
			        ps.setInt(4,Age);
			        ps.setString(5,Direction);
			        result = ps.executeUpdate();
			        
			        System.out.println();
					System.out.println("Sign up complete!");
					System.out.println();
					continue;
				}
			
				else if(bit.contains("2")) 
				{ 	//bit1�� sign in
					System.out.println();
					System.out.print("ID : ");
					String uID = scan.nextLine();
					System.out.print("PW : ");
					String PWD = scan.nextLine();
					sql = "select pwd from host where uID = ?;";
					ps = conn.prepareStatement(sql);
					ps.clearParameters();
					ps.setString(1,uID);
					rs = ps.executeQuery();
				
					rs.next();
					String PWD_in_table = rs.getString(1);
				
					if(!PWD.equals(PWD_in_table)) //��й�ȣ �Է��� Ʋ����,
					{
						System.out.println("Password is incorrect\n");
		
						continue;
					}
				
					System.out.println();
					System.out.println("Welcome!\n");
					System.out.println("-----------------");
					System.out.println("1. ����");
					System.out.println("2. �Ĵ�");
					System.out.println("3. ����");
					System.out.println("4. ����Ȯ��");
					System.out.println("5. exit");
					System.out.println("-----------------");
				
					int token = scan.nextInt();
					
					if(token==1) {//����, ��������
						String first = "";
						String second = "";
						String third = "";
						String class_l = "";
						System.out.println();
						System.out.println("Select 1 or 2");
						System.out.println("-----------------");
						System.out.println("1. ���ֽ�����");
						System.out.println("2. ���Ÿ���");
						System.out.println("-----------------");
					
						int token1 = scan.nextInt();
						System.out.println();
						if(token1==1) {
							System.out.println("Selected '���ֽ�����'");
							first ="���ֽ�����";
						}
						else if(token1==2) {
							System.out.println("Select '���Ÿ���'");
							first ="���Ÿ���";
						}
					
						System.out.println();
						System.out.println("-----------------");
						System.out.println("1. ��ä ");
						System.out.println("2. �ټ��� ");
						System.out.println("-----------------");
						int token11 = scan.nextInt();
						System.out.println();
						if(token11 == 1) {
							System.out.println("Select '��ä' ");
							second = "��ä ";
						}
						if(token11 == 2) {
							System.out.println("Select '�ټ���'");
							second = "�ټ��� ";
						}
					
						scan.nextLine();
						System.out.println();
						System.out.println("-----------------");
						System.out.println("1. ����");
						System.out.println("2. ������");
						System.out.println("-----------------");
					
					
						String temp = scan.nextLine();
					
						int token111;
						if(temp.contains("1"))
							token111 = 1;
						else
							token111 = 2;
						System.out.println();
						if(token111 == 1) {
							System.out.println("Select '����' ");
							third = "���� ";
						}
						if(token111 == 2) {
							System.out.println("Select '������'");
							third = "������ ";
						}
					
						String select = String.valueOf(token1).concat(String.valueOf(token11));
						select = select.concat(String.valueOf(token111));
					//select�� 111~222
					
						statement = conn.createStatement();
						sql = "select direction from host where uid = "+ uID +"::varchar"+";";
						String direction = Methods.user_dir(statement, sql);
						
						
						System.out.println(select);
						System.out.println();
						System.out.println("---------------���----------------");
						System.out.println("���õ� " + first + " , " + second +  " , " + third);
						Methods.lodg(statement, direction, select, uID);
						System.out.println();
					
					}
				
					else if(token==2) {//����, ������ ����
						System.out.println();
						System.out.println("Select");
						System.out.println("-----------------");
						System.out.println("1. ��������");
						System.out.println("2. �Ϲ�����");
						System.out.println("-----------------");
			            ArrayList<String> candidate_menu = new ArrayList<>();
						int token2 = scan.nextInt();
						
						if(token2==1) 
						{
							//������
							sql = "select distinct menu from nativefood;";
				            ps = conn.prepareStatement(sql);
				            rs = ps.executeQuery();
				            String[] native_menu = new String[115];
				            int i = 0;
				            while(rs.next())
				            {
				            	if(rs.getString(1).contains("("))
				            	{
				            		continue;
				            	}
				            	else if(rs.getString(1).contains("+"))
				            	{
				            		String[] temp = rs.getString(1).split("\\+");
				            		for(int k=0;k<temp.length;k++)
				            		{
				            			native_menu[i] = temp[k];
				            			i++;
				            		}
				            		continue;
				            	}
				            	native_menu[i] = rs.getString(1);
				                i++;
				            }
				            
				            System.out.println();

				            for(String menu : native_menu){
				                if(!candidate_menu.contains(menu))
				                {
				                	if(!menu.contains("."))
				                	{
				                		if(!menu.contains(","))
				                		{
				                			candidate_menu.add(menu);
				                		}
				                	}
				                }
				            }
				            
			
				            Collections.shuffle(candidate_menu); //Array��ҵ� ���� 
				            
				          
				            
						}
						else if(token2==2) 
						{
							//�Ϲ�����
							sql = "select distinct menu from ordinaryfood;";
							ps = conn.prepareStatement(sql);
				            rs = ps.executeQuery();
				            
				            String[] ordinary_menu = new String[370];
				            int i = 0;
				            while(rs.next())
				            {
				            	if(rs.getString(1) == null || rs.getString(1).contains("(") )
				            	{
				            		continue;
				            	}
				            	else if(rs.getString(1).contains(","))
				            	{
				            		String[] temp = rs.getString(1).split("\\,");
				            		for(int k=0;k<temp.length;k++)
				            		{
				            			ordinary_menu[i] = temp[k];
				            			i++;
				            		}
				            		continue;
				            	}
				            	ordinary_menu[i] = rs.getString(1);
				                i++;
				            }
				            
				            System.out.println();

				            for(String menu : ordinary_menu){
				                if(!candidate_menu.contains(menu))
				                {
				                	if(!menu.contains("."))
				                	{
				                		if(!menu.contains(","))
				                		{
				                			candidate_menu.add(menu);
				                		}
				                	}
				                }
				            }
				            Collections.shuffle(candidate_menu); //Array��ҵ� ����   
						}
						
						//candidate_menu�� �� �־���, ���� �տ��� 16���̾Ƽ� �d���Ž���
						String[] round1 = new String[16];
						String[] round2 = new String[8];
						String[] round3 = new String[4];
						String[] round4 = new String[2];
						String winner;
						for(int i=0;i<16;i++)
						{
							round1[i] = candidate_menu.get(i);
						}
						
						int k = 15;
						System.out.println("-----------------");
						System.out.println("       16��      ");
						System.out.println("-----------------");
						for(int i=0; i<8; i++)
						{
							System.out.println();
							System.out.println("Select");
							System.out.println("1. " + round1[i]);
							System.out.println("2. " + round1[k]);
							if(scan.nextInt() == 1)
							{
								System.out.println(round1[i] + " �¸�!");
								round2[i] = round1[i];
							}
							else
							{
								System.out.println(round1[k] + " �¸�!");
								round2[i] = round1[k];
							}
							k--;
						}
						
						System.out.println();
						System.out.println();
						System.out.println("-----------------");
						System.out.println("       8��      ");
						System.out.println("-----------------");
						k = 7;
						for(int i=0; i<4; i++)
						{
							System.out.println();
							System.out.println("Select");
							System.out.println("1. " + round2[i]);
							System.out.println("2. " + round2[k]);
							if(scan.nextInt() == 1)
							{
								System.out.println(round2[i] + " �¸�!");
								round3[i] = round2[i];
							}
							else
							{
								System.out.println(round2[k] + " �¸�!");
								round3[i] = round2[k];
							}
							k--;
						}
						
						System.out.println();
						System.out.println();
						System.out.println("-----------------");
						System.out.println("       4��      ");
						System.out.println("-----------------");
						k = 3;
						for(int i=0; i<2; i++)
						{
							System.out.println();
							System.out.println("Select");
							System.out.println("1. " + round3[i]);
							System.out.println("2. " + round3[k]);
							if(scan.nextInt() == 1)
							{
								System.out.println(round3[i] + " �¸�!");
								round4[i] = round3[i];
							}
							else
							{
								System.out.println(round2[k] + " �¸�!");
								round4[i] = round3[k];
							}
							k--;
						}
						
						System.out.println();
						System.out.println();
						System.out.println("-----------------");
						System.out.println("       ���      ");
						System.out.println("-----------------");
						k = 1;
						
						System.out.println();
						System.out.println("Select");
						System.out.println("1. " + round4[0]);
						System.out.println("2. " + round4[1]);
						if(scan.nextInt() == 1)
						{
							System.out.println(round4[0] + " �¸�!");
							winner= round4[0];
						}
						else
						{
							System.out.println(round2[k] + " �¸�!");
							winner = round4[1];
						}
						
						System.out.println();
						System.out.println("-----------------");
						System.out.println("   �������" + winner);
						System.out.println("-----------------");
						
						System.out.println();
						System.out.println();
						System.out.println("---------------------------------------------------------------------------------------------------------------------------");
						System.out.println();
						System.out.println(winner + " �Ǹž���");
						String tableName = "ordinaryfood";
						if(token2==1) //winner�� ���Ե� nativefood table�����������ش� 
						{
							if(Direction.equals("N"))
							{
								sql = "select rname,loc,phonenum,menu from nativefood where menu LIKE ? and (loc LIKE '%�ֿ�%' or loc LIKE '%��õ%');";
							}
							else if(Direction.equals("E"))
							{
								sql = "select rname,loc,phonenum,menu from nativefood where menu LIKE ? and (loc LIKE '%����%' or loc LIKE '%����%');";
							}
							else if(Direction.equals("W"))
							{
								sql = "select rname,loc,phonenum,menu from nativefood where menu LIKE ? and (loc LIKE '%�Ѱ�%' or loc LIKE '%�Ѹ�%' or loc LIKE '%����%');";
							}
							else
							{
								sql = "select rname,loc,phonenum,menu from nativefood where menu LIKE ? and (loc LIKE '%�ȴ�%' or loc LIKE '%ǥ��%' or loc LIKE '%����%');";
							}
						}
						else
						{
							if(Direction.equals("N"))
							{
								sql = "select rname,loc,phonenum,menu from ordinaryfood where menu LIKE ? and (loc LIKE '%�ֿ�%' or loc LIKE '%��õ%');";
							}
							else if(Direction.equals("E"))
							{
								sql = "select rname,loc,phonenum,menu from ordinaryfood where menu LIKE ? and (loc LIKE '%����%' or loc LIKE '%����%');";
							}
							else if(Direction.equals("W"))
							{
								sql = "select rname,loc,phonenum,menu from ordinaryfood where menu LIKE ? and (loc LIKE '%�Ѱ�%' or loc LIKE '%�Ѹ�%' or loc LIKE '%����%');";
							}
							else
							{
								sql = "select rname,loc,phonenum,menu from ordinaryfood where menu LIKE ? and (loc LIKE '%�ȴ�%' or loc LIKE '%ǥ��%' or loc LIKE '%����%');";
							}
		
						}
						
						ps = conn.prepareStatement(sql);
						ps.clearParameters();
					    ps.setString(1, "%" + winner + "%");
						rs = ps.executeQuery();
						
						while(rs.next())
						{
							System.out.println(rs.getString(1) + "\t\t" + rs.getString(2) + "\t\t" + rs.getString(3) + "\t\t" + rs.getString(4));
						}
						System.out.println("---------------------------------------------------------------------------------------------------------------------------");
						System.out.println();
						System.out.println("�ʱ�ȭ�����ε��ư��ϴ� ");
						System.out.println();
						scan.nextLine();
					}
				
					else if(token==3) {//������ ��
						String first = "";
						String select = "";
						System.out.println();
						System.out.println("Select 1 or 2");
						System.out.println("-----------------");
						System.out.println("1. Ȱ������ ");
						System.out.println("2. ������ ");
						System.out.println("3. �÷��� ");
						System.out.println("4. ī������ ");
						System.out.println("-----------------");
					
						int token1 = scan.nextInt();
						System.out.println();
						if(token1==1) {
							System.out.println("Selected 'Ȱ������'");
							first ="  Ȱ������ ";
							select= select + Integer.toString(token1);
							
							System.out.println();
							System.out.println("-----------------");
							System.out.println("1. �ٴ� ");
							System.out.println("2. �� ");
							System.out.println("-----------------");
							int token11 = scan.nextInt();
							
							if(token11 == 1) {
								System.out.println("Select '�ٴ�'");
								first = first + "  �ٴ� ";
								select = select + Integer.toString(token11);
								
							}else if(token11 == 2) {
								System.out.println("Select '��'");
								first = first + "  �� ";
								select = select + Integer.toString(token11);
								
								System.out.println();
								System.out.println("-----------------");
								System.out.println("1. �¸� ");
								System.out.println("2. ���� ");
								System.out.println("-----------------");
								int token111 = scan.nextInt();
								
								if(token111 == 1) {
									System.out.println("Selected '�¸�'");
									first = first + "  �¸� ";
									select = select + Integer.toString(token111);
								}else if(token111 == 2) {
									System.out.println("Selected '����'");
									first = first + "  ���� ";
									select = select + Integer.toString(token111);
								}
							}
						}
						else if(token1==2) {
							System.out.println("Select '������'");
							first ="  ������ ";
							select = select + Integer.toString(token1);
							
							System.out.println();
							System.out.println("-----------------");
							System.out.println("1. �ٴ� ");
							System.out.println("2. �� ");
							System.out.println("3. ��Ÿ ");
							System.out.println("-----------------");
							int token11 = scan.nextInt();
							
							if(token11 == 1) {
								System.out.println("Select '�ٴ�'");
								first = first + "  �ٴ� ";
								select = select + Integer.toString(token11);
					
							}else if(token11 == 2) {
								System.out.println("Select '��'");
								first = first +  "  �� ";
								select = select + Integer.toString(token11);
								
								System.out.println();
								System.out.println("-----------------");
								System.out.println("1. �Ĺ��� ");
								System.out.println("2. ������� ");
								System.out.println("3. ���� ");
								System.out.println("-----------------");
								int token111 = scan.nextInt();
								
								if(token111 == 1) {
									System.out.println("Select '�Ĺ���'");
									first = first + "  �Ĺ��� ";
									select = select + Integer.toString(token111);
								}else if(token111 == 2) {
									System.out.println("Select '�������'");
									first = first + "  ������� ";
									select = select + Integer.toString(token111);
								}
							}else if(token11 == 3) {
								System.out.println("Select '��Ÿ'");
								first = first +  "  ��Ÿ ";
								select = select + Integer.toString(token11);
							}
						}
						else if(token1==4) {
							System.out.println("Select 'ī������'");
							first ="  ī������ ";
							select = select + Integer.toString(token1);
						}
						
						System.out.println();
						
						statement = conn.createStatement();

						System.out.println(select);
						System.out.println();
						System.out.println("---------------���----------------");
						System.out.println(first);
						sql = "select direction from host where uid = "+ uID +"::varchar"+";";
						String direction = Methods.user_dir(statement, sql);
						Methods.attraction(statement, select, direction, uID);
						
						scan.nextLine();

					}
					else if(token==4) {
						System.out.println("Select");
						System.out.println("-----------------");
						System.out.println("1. Most selected in ����");
						System.out.println("2. Most selected in ����");
						System.out.println("2. Most selected in ����");
						System.out.println("-----------------");
					
						int token4 = scan.nextInt();
						if(token4==1) {
							System.out.println("ID : 131���� ������ ��/20��/���ֵ� ���� ������ ���� �α��ִ� ������");
							System.out.println("ī�װ� : ��������, ����:��¦����");
							System.out.println("�Ĵ�");
							System.out.println("�̸� : ~~~~ / �ּ�:~~~~ /  �����ð�:~~~");
							System.out.println("�̸� : ~~~~ / �ּ�:~~~~ /  �����ð�:~~~");
							System.out.println("�̸� : ~~~~ / �ּ�:~~~~ /  �����ð�:~~~");
						
						}
						else if(token4==2) {
							System.out.println("ID : ~~~���� ������ ��/20��/���ֵ� ���� ������ ���� �α��ִ� ��������");
							System.out.println("ī�װ�: ~~~-~~~-~~~ �������� : ~~~~~~~~~~");
						}
						else if(token4==3) {
							System.out.println("ID : ~~~���� ������ ��/20��/���ֵ� ���� ������ ���� �α��ִ� �������´�");
							System.out.println("ī�װ�: ~~~-~~~-~~~ ���� : ~~~~~~~~~~");
						}
					
				
					
						}
					else {
						continue;
						}
					
				
				}
				else if(bit.contains("3")) 	//bit3��exit
				{
					return;
				
				}
				else if(bit.contains("4")) //bit4�� �����ڸ�
			      {
			         System.out.println();
			         System.out.println("�����ڸ�� ");
			         System.out.println("-----------------");
			         System.out.println("1. �����Ͱ���");
			         System.out.println("2. ȸ������");
			         System.out.println("-----------------");
			         String bit2 = scan.nextLine();
			         if(bit2.contains("1"))
			         {
			            System.out.println();
			            System.out.println("�����Ͱ��� ");
			            String bit3 = scan.nextLine();
			            if(bit3.contains("1"))
			            {
			               System.out.println();
			               System.out.println("�������߰�");
			            }
			            else if(bit3.contains("2"))
			            {
			               System.out.println();
			               System.out.println("�����ͻ���");
			            }
			            
			         }
			         else if(bit2.contains("2"))//ȸ������
			         {
			            System.out.println();
			            System.out.println("ȸ������ ");
			            System.out.println("-----------------");
			            System.out.println("1. ��ü ����� Ȯ��");
			            System.out.println("2. ����� ����");
			            System.out.println("2. ����� ����");
			            System.out.println("-----------------");
			            String bit3 = scan.nextLine();
			            String uID, upwd, sex,age, dir;
			            
			            if(bit3.contains("1")) {//��ü ����� Ȯ��
			               sql="select * from host;";
			               ps = conn.prepareStatement(sql);
			               rs = ps.executeQuery();
			         
			               System.out.println("-----------------------------------------------------");
			               System.out.println("  \tuID\tpwd\tsex\tage\tdir");
			               int index=1;
			               while (rs.next()) {
			                  uID = rs.getString(1);
			                  upwd = rs.getString(2);
			                  sex = rs.getString(3);
			                  age = rs.getString(4);
			                  dir = rs.getString(5);
			                  System.out.printf("%d:\t%-16s\t%-16s\t%-16s\t%-16s\t%-16s\n",index,uID, upwd,sex,age,dir);
			                  index++;
			               }
			               System.out.println("-----------------------------------------------------");
			               index=1;
			            }
			            else if(bit3.contains("2")) { // ����� ����
			               System.out.println("-----------------------------------------------------");
			               System.out.println("������ ����� ID : ");
			               String del_uID = scan.nextLine();
			               sql = "select * from host where uID = ?;";
			               ps = conn.prepareStatement(sql);
			                 ps.clearParameters();
			                 ps.setString(1,del_uID);
			                 rs = ps.executeQuery();
			                 
			                 System.out.println("-----------------------------------------------------");
			               System.out.println("  \tuID\tpwd\tsex\tage\tdir");
			               int index=1;
			               while (rs.next()) {
			                  uID = rs.getString(1);
			                  upwd = rs.getString(2);
			                  sex = rs.getString(3);
			                  age = rs.getString(4);
			                  dir = rs.getString(5);
			                  System.out.printf("%d:\t%-16s\t%-16s\t%-16s\t%-16s\t%-16s\n",index,uID, upwd,sex,age,dir);
			                  index++;
			               }
			               System.out.println("-----------------------------------------------------");
			               index=1;
			               
			               System.out.println("���� ����ڸ� �����Ͻðڽ��ϱ�? (y/n)");
			               String bit4 = scan.nextLine();
			               if(bit4.contains("y")){
			                  sql = "delete from host where uID = ?;";
			                  ps = conn.prepareStatement(sql);
			                    ps.clearParameters();
			                    ps.setString(1,del_uID);
			                    rs = ps.executeQuery();
			                    System.out.println("������ �Ϸ�Ǿ����ϴ�.");
			               }
			               else {
			                  System.out.println("���");
			               }
			               
			            }
			            
			            
			         }
			      }
		            
		            
		     
		      }
			
			
			
		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}
}
